<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/delafits/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/delafits/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/delafits/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Get Started | DeLaFits</title><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Get Started" /><meta property="og:locale" content="en_US" /><meta name="description" content="DeLaFits library documentation" /><meta property="og:description" content="DeLaFits library documentation" /><link rel="canonical" href="https://felleroff.github.io/delafits/pages/getstarted/" /><meta property="og:url" content="https://felleroff.github.io/delafits/pages/getstarted/" /><meta property="og:site_name" content="DeLaFits" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Get Started" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"DeLaFits library documentation","headline":"Get Started","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://felleroff.github.io/delafits/assets/images/delafits.png"}},"url":"https://felleroff.github.io/delafits/pages/getstarted/"}</script><link rel="icon" type="image/png" href="/delafits/assets/images/favicon-96x96.png" sizes="96x96" /><link rel="icon" type="image/svg+xml" href="/delafits/assets/images/favicon.svg" /><link rel="shortcut icon" href="/delafits/assets/images/favicon.ico" /><link rel="apple-touch-icon" sizes="180x180" href="/delafits/assets/images/apple-touch-icon.png" /><meta name="apple-mobile-web-app-title" content="DeLaFits" /><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="https://felleroff.github.io/delafits/" class="site-title lh-tight"><div class="site-logo">DeLaFits</div></a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="https://felleroff.github.io/delafits/" class="nav-list-link">Overview</a><li class="nav-list-item active"><a href="https://felleroff.github.io/delafits/pages/getstarted/" class="nav-list-link active">Get Started</a><li class="nav-list-item"><a href="https://felleroff.github.io/delafits/pages/design/" class="nav-list-link">Design</a><li class="nav-list-item"><a href="https://felleroff.github.io/delafits/pages/compilation/" class="nav-list-link">Compilation</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://felleroff.github.io/delafits/pages/errors" class="nav-list-link">Errors</a><ul class="nav-list "><li class="nav-list-item "><a href="https://felleroff.github.io/delafits/pages/errors/delafitscommon/" class="nav-list-link">Error codes 1000-1999</a><li class="nav-list-item "><a href="https://felleroff.github.io/delafits/pages/errors/delafitsmath/" class="nav-list-link">Error codes 2000-2999</a><li class="nav-list-item "><a href="https://felleroff.github.io/delafits/pages/errors/delafitsstring/" class="nav-list-link">Error codes 3000-3999</a><li class="nav-list-item "><a href="https://felleroff.github.io/delafits/pages/errors/delafitsprop/" class="nav-list-link">Error codes 4000-4999</a></ul></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search" aria-label="Search" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="//github.com/felleroff/delafits" class="site-button" > DeLaFits on GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><div id="main-content" class="main-content" role="main"><h3 class="no_toc" id="get-started"> <a href="#get-started" class="anchor-heading" aria-labelledby="get-started"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Get Started</h3><p>Read about the <a href="https://fits.gsfc.nasa.gov/standard40/fits_standard40aa-le.pdf#page=10" title="The FITS Standard 4.0, Sect. 3. FITS file organization">FITS file organization</a>. FITS is an HDU container. Each HDU consists of a header and a data section. The header is a set of keyword records in the form of ASCII “keyword=value/note” cards. The data section is a stream of bytes encoded according to the HDU extension.</p><p>Add the library’s “source” directory to your project’s search path.</p><p>Review the examples of working with FITS:</p><ul id="markdown-toc"><li><a href="#example-1-read-and-write-the-hdu-header" id="markdown-toc-example-1-read-and-write-the-hdu-header">Example 1. Read and write the HDU header</a><li><a href="#example-2-read-and-write-the-hdu-data" id="markdown-toc-example-2-read-and-write-the-hdu-data">Example 2. Read and write the HDU data</a><li><a href="#example-3-read-and-write-the-image-values" id="markdown-toc-example-3-read-and-write-the-image-values">Example 3. Read and write the IMAGE values</a><li><a href="#example-4-create-a-new-image-frame" id="markdown-toc-example-4-create-a-new-image-frame">Example 4. Create a new IMAGE frame</a><li><a href="#example-5-render-an-image-frame" id="markdown-toc-example-5-render-an-image-frame">Example 5. Render an IMAGE frame</a><li><a href="#example-6-create-a-new-table" id="markdown-toc-example-6-create-a-new-table">Example 6. Create a new TABLE</a><li><a href="#example-7-read-and-write-the-table-records" id="markdown-toc-example-7-read-and-write-the-table-records">Example 7. Read and write the TABLE records</a></ul><h3 id="example-1-read-and-write-the-hdu-header"> <a href="#example-1-read-and-write-the-hdu-header" class="anchor-heading" aria-labelledby="example-1-read-and-write-the-hdu-header"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example 1. Read and write the HDU header</h3><p>To work with keyword records in the HDU header, create specialized card objects. Each descendant of the TFitsCard class implements methods for reading and writing the keyword name, as well as its associated value and note. See also the “itemhead” demo.</p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">uses</span>
  <span class="p">...,</span> <span class="n">DeLaFitsCommon</span><span class="p">,</span> <span class="n">DeLaFitsClasses</span><span class="p">,</span> <span class="n">DeLaFitsCard</span><span class="p">;</span>
</code></pre></div></div><p><em>Create the FITS container: open and parse the FITS file</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LStream</span> <span class="p">:=</span> <span class="n">TFileStream</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">'demo-item.fits'</span><span class="p">,</span> <span class="n">fmOpenReadWrite</span><span class="p">);</span>
<span class="n">LContainer</span> <span class="p">:=</span> <span class="n">TFitsContainer</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">LStream</span><span class="p">);</span>
</code></pre></div></div><p><em>The FITS container contains a list of HDUs. Get the header of the selected HDU</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">LIndex</span> <span class="p">:=</span> <span class="m">0</span> <span class="k">to</span> <span class="n">LContainer</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span> <span class="k">do</span>
  <span class="n">LItem</span> <span class="p">:=</span> <span class="n">LContainer</span><span class="p">.</span><span class="n">Items</span><span class="p">[</span><span class="n">LIndex</span><span class="p">];</span>
<span class="n">LHead</span> <span class="p">:=</span> <span class="n">LItem</span><span class="p">.</span><span class="n">Head</span><span class="p">;</span>
</code></pre></div></div><p><em>Loop through the header cards</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">LHead</span><span class="p">.</span><span class="n">FirstCard</span> <span class="k">then</span>
<span class="k">repeat</span>
  <span class="n">LKeyword</span> <span class="p">:=</span> <span class="n">LHead</span><span class="p">.</span><span class="n">CardKeyword</span><span class="p">;</span>
  <span class="p">...</span>
<span class="k">until</span> <span class="k">not</span> <span class="n">LHead</span><span class="p">.</span><span class="n">NextCard</span><span class="p">;</span>
</code></pre></div></div><p><em>Get the Right ascension of the observed object defined by the keyword “RA”</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LCard</span> <span class="p">:=</span> <span class="n">TFitsRightAscensionCard</span><span class="p">.</span><span class="n">Create</span><span class="p">;</span>
<span class="k">if</span> <span class="n">LHead</span><span class="p">.</span><span class="n">LocateCard</span><span class="p">(</span><span class="s">'RA'</span><span class="p">)</span> <span class="k">then</span>
<span class="k">begin</span>
  <span class="n">LCard</span><span class="p">.</span><span class="n">Card</span> <span class="p">:=</span> <span class="n">LHead</span><span class="p">.</span><span class="n">Card</span><span class="p">;</span>
  <span class="n">LValue</span> <span class="p">:=</span> <span class="n">LCard</span><span class="p">.</span><span class="n">ValueAsDouble</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
<span class="n">LCard</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
</code></pre></div></div><p><em>Set the observation date defined by the keyword “DATE-OBS”</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LCard</span> <span class="p">:=</span> <span class="n">TFitsDateTimeCard</span><span class="p">.</span><span class="n">Create</span><span class="p">;</span>
<span class="k">if</span> <span class="n">LHead</span><span class="p">.</span><span class="n">LocateCard</span><span class="p">(</span><span class="s">'DATE-OBS'</span><span class="p">)</span> <span class="k">then</span>
<span class="k">begin</span>
  <span class="n">LCard</span><span class="p">.</span><span class="n">Card</span> <span class="p">:=</span> <span class="n">LHead</span><span class="p">.</span><span class="n">Card</span><span class="p">;</span>
  <span class="n">LCard</span><span class="p">.</span><span class="n">ValueAsDateTime</span> <span class="p">:=</span> <span class="n">Now</span><span class="p">;</span>
  <span class="n">LHead</span><span class="p">.</span><span class="n">Card</span> <span class="p">:=</span> <span class="n">LCard</span><span class="p">.</span><span class="n">Card</span><span class="p">;</span>
<span class="k">end</span> <span class="k">else</span>
<span class="k">begin</span>
  <span class="n">LCard</span><span class="p">.</span><span class="n">Keyword</span> <span class="p">:=</span> <span class="s">'DATE-OBS'</span><span class="p">;</span>
  <span class="n">LCard</span><span class="p">.</span><span class="n">ValueAsDateTime</span> <span class="p">:=</span> <span class="n">Now</span><span class="p">;</span>
  <span class="n">LCard</span><span class="p">.</span><span class="n">Note</span> <span class="p">:=</span> <span class="s">'Date of the observation'</span><span class="p">;</span>
  <span class="n">LHead</span><span class="p">.</span><span class="n">AddCard</span><span class="p">(</span><span class="n">LCard</span><span class="p">.</span><span class="n">Card</span><span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
<span class="n">LCard</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
</code></pre></div></div><p><em>Free objects</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LContainer</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
<span class="n">LStream</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
</code></pre></div></div><p><a href="#">⮝</a></p><h3 id="example-2-read-and-write-the-hdu-data"> <a href="#example-2-read-and-write-the-hdu-data" class="anchor-heading" aria-labelledby="example-2-read-and-write-the-hdu-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example 2. Read and write the HDU data</h3><p>To work with the raw byte stream of the HDU data, use the properties and methods of the TFitsItemData instance. Important! Content access methods do not convert the byte stream into physical values. See also the “itemdata” demo.</p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">uses</span>
  <span class="p">...,</span> <span class="n">DeLaFitsCommon</span><span class="p">,</span> <span class="n">DeLaFitsClasses</span><span class="p">;</span>
</code></pre></div></div><p><em>Create the FITS container: open and parse the FITS file</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LStream</span> <span class="p">:=</span> <span class="n">TFileStream</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">'demo-item.fits'</span><span class="p">,</span> <span class="n">fmOpenReadWrite</span><span class="p">);</span>
<span class="n">LContainer</span> <span class="p">:=</span> <span class="n">TFitsContainer</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">LStream</span><span class="p">);</span>
</code></pre></div></div><p><em>The FITS container contains a list of HDUs. Get the data object of the selected HDU</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">LIndex</span> <span class="p">:=</span> <span class="m">0</span> <span class="k">to</span> <span class="n">LContainer</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="m">1</span> <span class="k">do</span>
  <span class="n">LItem</span> <span class="p">:=</span> <span class="n">LContainer</span><span class="p">.</span><span class="n">Items</span><span class="p">[</span><span class="n">LIndex</span><span class="p">];</span>
<span class="n">LData</span> <span class="p">:=</span> <span class="n">LItem</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
</code></pre></div></div><p><em>Read the data contents</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">LChunk</span><span class="p">:</span> <span class="k">array</span> <span class="k">of</span> <span class="kt">Byte</span><span class="p">;</span>
<span class="n">SetLength</span><span class="p">(</span><span class="n">LChunk</span><span class="p">,</span> <span class="n">LData</span><span class="p">.</span><span class="n">InternalSize</span><span class="p">);</span>    
<span class="n">LData</span><span class="p">.</span><span class="n">ReadChunk</span><span class="p">(</span><span class="cm">{AInternalOffset:}</span> <span class="m">0</span><span class="p">,</span> <span class="n">Length</span><span class="p">(</span><span class="n">LChunk</span><span class="p">),</span> <span class="cm">{var}</span> <span class="n">LChunk</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
</code></pre></div></div><p><em>Write the data contents</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">LChunk</span><span class="p">:</span> <span class="k">array</span> <span class="k">of</span> <span class="kt">Byte</span><span class="p">;</span>
<span class="n">SetLength</span><span class="p">(</span><span class="n">LChunk</span><span class="p">,</span> <span class="n">LData</span><span class="p">.</span><span class="n">InternalSize</span><span class="p">);</span>
<span class="n">FillChar</span><span class="p">(</span><span class="n">LChunk</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">Length</span><span class="p">(</span><span class="n">LChunk</span><span class="p">),</span> <span class="mh">$FF</span><span class="p">);</span>
<span class="n">LData</span><span class="p">.</span><span class="n">WriteChunk</span><span class="p">(</span><span class="cm">{AInternalOffset:}</span> <span class="m">0</span><span class="p">,</span> <span class="n">Length</span><span class="p">(</span><span class="n">LChunk</span><span class="p">),</span> <span class="n">LChunk</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
</code></pre></div></div><p><em>Free objects</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LContainer</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
<span class="n">LStream</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
</code></pre></div></div><p><a href="#">⮝</a></p><h3 id="example-3-read-and-write-the-image-values"> <a href="#example-3-read-and-write-the-image-values" class="anchor-heading" aria-labelledby="example-3-read-and-write-the-image-values"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example 3. Read and write the IMAGE values</h3><p>To work with physical values of the IMAGE extension, set the HDU class as TFitsImage and use the properties and methods of its data object. See also the “imagevalues” demo.</p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">uses</span>
  <span class="p">...,</span> <span class="n">DeLaFitsCommon</span><span class="p">,</span> <span class="n">DeLaFitsClasses</span><span class="p">,</span> <span class="n">DeLaFitsImage</span><span class="p">;</span>
</code></pre></div></div><p><em>Create the FITS container: open and parse the FITS file</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LStream</span> <span class="p">:=</span> <span class="n">TFileStream</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">'demo-image.fits'</span><span class="p">,</span> <span class="n">fmOpenReadWrite</span><span class="p">);</span>
<span class="n">LContainer</span> <span class="p">:=</span> <span class="n">TFitsContainer</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">LStream</span><span class="p">);</span>
</code></pre></div></div><p><em>Set the HDU class to TFitsImage and get its data object</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LIndex</span> <span class="p">:=</span> <span class="m">0</span><span class="p">;</span>
<span class="k">if</span> <span class="n">LContainer</span><span class="p">.</span><span class="n">ItemExtensionTypeIs</span><span class="p">(</span><span class="n">LIndex</span><span class="p">,</span> <span class="n">TFitsImage</span><span class="p">)</span> <span class="k">then</span>
<span class="k">begin</span>
  <span class="n">LContainer</span><span class="p">.</span><span class="n">ItemClasses</span><span class="p">[</span><span class="n">LIndex</span><span class="p">]</span> <span class="p">:=</span> <span class="n">TFitsImage</span><span class="p">;</span>
  <span class="n">LImage</span> <span class="p">:=</span> <span class="n">LContainer</span><span class="p">.</span><span class="n">Items</span><span class="p">[</span><span class="n">LIndex</span><span class="p">]</span> <span class="k">as</span> <span class="n">TFitsImage</span><span class="p">;</span>
  <span class="n">LData</span> <span class="p">:=</span> <span class="n">LImage</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</code></pre></div></div><p><em>Get the optimal buffer type and read the physical values of the IMAGE data</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="n">LData</span><span class="p">.</span><span class="n">ValueType</span> <span class="k">of</span>
  <span class="c1">// floating-point physical values
</span>  <span class="n">num80f</span><span class="p">,</span> <span class="n">num64f</span><span class="p">,</span> <span class="n">num32f</span><span class="p">:</span>
    <span class="k">begin</span>
      <span class="k">var</span> <span class="n">LBuffer</span><span class="p">:</span> <span class="k">array</span> <span class="k">of</span> <span class="kt">Extended</span><span class="p">;</span>
      <span class="n">SetLength</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">,</span> <span class="n">LData</span><span class="p">.</span><span class="n">ValueCount</span><span class="p">);</span>
      <span class="n">LData</span><span class="p">.</span><span class="n">ReadValues</span><span class="p">(</span><span class="cm">{AIndex:}</span> <span class="m">0</span><span class="p">,</span> <span class="n">Length</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">),</span> <span class="cm">{var}</span> <span class="n">TA80f</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">));</span>
    <span class="k">end</span><span class="p">;</span>
  <span class="c1">// integer physical values
</span>  <span class="n">num08c</span><span class="p">,</span> <span class="n">num08u</span><span class="p">,</span> <span class="n">num16c</span><span class="p">,</span> <span class="n">num16u</span><span class="p">,</span> <span class="n">num32c</span><span class="p">,</span> <span class="n">num32u</span><span class="p">,</span> <span class="n">num64c</span><span class="p">:</span>
    <span class="k">begin</span>
      <span class="k">var</span> <span class="n">LBuffer</span><span class="p">:</span> <span class="k">array</span> <span class="k">of</span> <span class="kt">Int64</span><span class="p">;</span>
      <span class="n">SetLength</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">,</span> <span class="n">LData</span><span class="p">.</span><span class="n">ValueCount</span><span class="p">);</span>
      <span class="n">LData</span><span class="p">.</span><span class="n">ReadValues</span><span class="p">(</span><span class="cm">{AIndex:}</span> <span class="m">0</span><span class="p">,</span> <span class="n">Length</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">),</span> <span class="cm">{var}</span> <span class="n">TA64c</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">));</span>
    <span class="k">end</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</code></pre></div></div><p><em>Write the physical values of the IMAGE data</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">LBuffer</span><span class="p">:</span> <span class="k">array</span> <span class="k">of</span> <span class="kt">Integer</span><span class="p">;</span>
<span class="n">SetLength</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">,</span> <span class="n">LData</span><span class="p">.</span><span class="n">ValueCount</span><span class="p">);</span>
<span class="k">for</span> <span class="n">LIndex</span> <span class="p">:=</span> <span class="n">Low</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">)</span> <span class="k">to</span> <span class="n">High</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">LBuffer</span><span class="p">[</span><span class="n">LIndex</span><span class="p">]</span> <span class="p">:=</span> <span class="p">...;</span>
<span class="n">LData</span><span class="p">.</span><span class="n">WriteValues</span><span class="p">(</span><span class="cm">{AIndex:}</span> <span class="m">0</span><span class="p">,</span> <span class="n">Length</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">),</span> <span class="n">TA32c</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">));</span>
</code></pre></div></div><p><em>Free objects</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LContainer</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
<span class="n">LStream</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
</code></pre></div></div><p><a href="#">⮝</a></p><h3 id="example-4-create-a-new-image-frame"> <a href="#example-4-create-a-new-image-frame" class="anchor-heading" aria-labelledby="example-4-create-a-new-image-frame"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example 4. Create a new IMAGE frame</h3><p>An IMAGE extension instance contains a multidimensional array of physical values in its data section. Such an array can be presented as a set of frames, which are two-dimensional arrays with dimensions [NAXIS1⨯NAXIS2]. To create a new frame, add an HDU of type TFitsPicture with the TFitsPictureSpec specification to the FITS container. Then, extract the TFitsFrame object and write the physical values into it. See also the “newframe” demo.</p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">uses</span>
  <span class="p">...,</span> <span class="n">DeLaFitsCommon</span><span class="p">,</span> <span class="n">DeLaFitsClasses</span><span class="p">,</span> <span class="n">DeLaFitsPicture</span><span class="p">;</span>
</code></pre></div></div><p><em>Create a new empty file and use it to create the FITS container</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LStream</span> <span class="p">:=</span> <span class="n">TFileStream</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">'new.fits'</span><span class="p">,</span> <span class="n">fmCreate</span><span class="p">);</span>
<span class="n">LContainer</span> <span class="p">:=</span> <span class="n">TFitsContainer</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">LStream</span><span class="p">);</span>
</code></pre></div></div><p><em>Create a specification for a new frame: array [1000⨯1200] of 16-bit unsigned integer values</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LSpec</span> <span class="p">:=</span> <span class="n">TFitsPictureSpec</span><span class="p">.</span><span class="n">CreateNew</span><span class="p">(</span>
  <span class="cm">{AValueType:}</span> <span class="n">num16u</span><span class="p">,</span>
  <span class="cm">{AFrameWidth:}</span> <span class="m">1000</span><span class="p">,</span>
  <span class="cm">{AFrameHeight:}</span> <span class="m">1200</span><span class="p">);</span>
</code></pre></div></div><p><em>Add a new HDU of type TFitsPicture (IMAGE extension) to the FITS container</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LPicture</span> <span class="p">:=</span> <span class="n">LContainer</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">TFitsPicture</span><span class="p">,</span> <span class="n">LSpec</span><span class="p">)</span> <span class="k">as</span> <span class="n">TFitsPicture</span><span class="p">;</span>
</code></pre></div></div><p><em>Get a handle to the first frame of the HDU</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LFrameHandle</span> <span class="p">:=</span> <span class="n">LPicture</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">FrameHandles</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
</code></pre></div></div><p><em>Create a new frame object</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LFrame</span> <span class="p">:=</span> <span class="n">TFitsFrame</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">LFrameHandle</span><span class="p">);</span>
</code></pre></div></div><p><em>Prepare a 16-bit unsigned integer buffer and write the frame values row by row</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">LBuffer</span><span class="p">:</span> <span class="k">array</span> <span class="k">of</span> <span class="kt">Word</span><span class="p">;</span>
<span class="n">SetLength</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">,</span> <span class="n">LFrame</span><span class="p">.</span><span class="n">Width</span><span class="p">);</span>
<span class="k">for</span> <span class="n">LY</span> <span class="p">:=</span> <span class="m">0</span> <span class="k">to</span> <span class="n">LFrame</span><span class="p">.</span><span class="n">Height</span> <span class="p">-</span> <span class="m">1</span> <span class="k">do</span>
<span class="k">begin</span>
  <span class="k">for</span> <span class="n">LX</span> <span class="p">:=</span> <span class="n">Low</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">)</span> <span class="k">to</span> <span class="n">High</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">)</span>
    <span class="n">LBuffer</span><span class="p">[</span><span class="n">LX</span><span class="p">]</span> <span class="p">:=</span> <span class="p">...;</span>
  <span class="n">LFrame</span><span class="p">.</span><span class="n">WriteValues</span><span class="p">(</span><span class="cm">{AX:}</span> <span class="m">0</span><span class="p">,</span> <span class="cm">{AY:}</span> <span class="n">LY</span><span class="p">,</span> <span class="n">Length</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">),</span> <span class="n">TA16u</span><span class="p">(</span><span class="n">LBuffer</span><span class="p">));</span>
<span class="k">end</span><span class="p">;</span>
</code></pre></div></div><p><em>Free objects</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LFrame</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
<span class="n">LSpec</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
<span class="n">LContainer</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
<span class="n">LStream</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
</code></pre></div></div><p><a href="#">⮝</a></p><h3 id="example-5-render-an-image-frame"> <a href="#example-5-render-an-image-frame" class="anchor-heading" aria-labelledby="example-5-render-an-image-frame"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example 5. Render an IMAGE frame</h3><p>The IMAGE extension instance contains a multidimensional array of physical values in its data section. Such an array can be presented as a set of frames, which are two-dimensional arrays with dimensions [NAXIS1⨯NAXIS2]. Set the HDU class to TFitsPicture, extract the frame as a TFitsFrame object, and use its properties and methods to create a bitmap of some region. See also the “renderframe” demo.</p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">uses</span>
  <span class="p">...,</span> <span class="n">DeLaFitsCommon</span><span class="p">,</span> <span class="n">DeLaFitsClasses</span><span class="p">,</span> <span class="n">DeLaFitsPicture</span><span class="p">;</span>
</code></pre></div></div><p><em>Create the FITS container: open and parse the FITS file</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LStream</span> <span class="p">:=</span> <span class="n">TFileStream</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">'demo-image.fits'</span><span class="p">,</span> <span class="n">fmOpenRead</span><span class="p">);</span>
<span class="n">LContainer</span> <span class="p">:=</span> <span class="n">TFitsContainer</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">LStream</span><span class="p">);</span>
</code></pre></div></div><p><em>Set the HDU class to TFitsPicture</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LIndex</span> <span class="p">:=</span> <span class="m">0</span><span class="p">;</span>
<span class="k">if</span> <span class="n">LContainer</span><span class="p">.</span><span class="n">ItemExtensionTypeIs</span><span class="p">(</span><span class="n">LIndex</span><span class="p">,</span> <span class="n">TFitsPicture</span><span class="p">)</span> <span class="k">then</span>
<span class="k">begin</span>
  <span class="n">LContainer</span><span class="p">.</span><span class="n">ItemClasses</span><span class="p">[</span><span class="n">LIndex</span><span class="p">]</span> <span class="p">:=</span> <span class="n">TFitsPicture</span><span class="p">;</span>
  <span class="n">LPicture</span> <span class="p">:=</span> <span class="n">LContainer</span><span class="p">.</span><span class="n">Items</span><span class="p">[</span><span class="n">LIndex</span><span class="p">]</span> <span class="k">as</span> <span class="n">TFitsPicture</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</code></pre></div></div><p><em>Get a handle to the first frame of the HDU</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LFrameHandle</span> <span class="p">:=</span> <span class="n">LPicture</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">FrameHandles</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
</code></pre></div></div><p><em>Create a frame object</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LFrame</span> <span class="p">:=</span> <span class="n">TFitsFrame</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">LFrameHandle</span><span class="p">);</span>
</code></pre></div></div><p><em>Optional. Set rendering parameters: increase contrast, invert color, and scale the frame scene</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LFrame</span><span class="p">.</span><span class="n">Tone</span><span class="p">.</span><span class="n">Contrast</span> <span class="p">:=</span> <span class="m">1.5</span><span class="p">;</span>
<span class="n">LFrame</span><span class="p">.</span><span class="n">Palette</span><span class="p">.</span><span class="n">Reverse</span> <span class="p">:=</span> <span class="nb">True</span><span class="p">;</span>
<span class="n">LFrame</span><span class="p">.</span><span class="n">Geometry</span><span class="p">.</span><span class="n">Scale</span><span class="p">(</span><span class="cm">{ASX:}</span> <span class="m">2.0</span><span class="p">,</span> <span class="cm">{ASY:}</span> <span class="m">2.0</span><span class="p">,</span> <span class="cm">{APoint:}</span> <span class="n">xy00</span><span class="p">);</span>
</code></pre></div></div><p><em>Create a some rendering region</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LRegion</span> <span class="p">:=</span> <span class="n">LFrame</span><span class="p">.</span><span class="n">SceneRegion</span><span class="p">;</span>
<span class="n">LRegion</span><span class="p">.</span><span class="n">Width</span> <span class="p">:=</span> <span class="m">400</span><span class="p">;</span>
<span class="n">LRegion</span><span class="p">.</span><span class="n">Height</span> <span class="p">:=</span> <span class="m">400</span><span class="p">;</span>
</code></pre></div></div><p><em>Create a bitmap object</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LBitmap</span> <span class="p">:=</span> <span class="n">TBitmap</span><span class="p">.</span><span class="n">Create</span><span class="p">;</span>
</code></pre></div></div><p><em>Render the frame scene</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LFrame</span><span class="p">.</span><span class="n">RenderScene</span><span class="p">(</span><span class="n">LRegion</span><span class="p">,</span> <span class="n">LBitmap</span><span class="p">);</span>
</code></pre></div></div><p><em>Free objects</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LBitmap</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
<span class="n">LFrame</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
<span class="n">LContainer</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
<span class="n">LStream</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
</code></pre></div></div><p><a href="#">⮝</a></p><h3 id="example-6-create-a-new-table"> <a href="#example-6-create-a-new-table" class="anchor-heading" aria-labelledby="example-6-create-a-new-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example 6. Create a new TABLE</h3><p>The TABLE extension instance provides a means of storing catalogs and tables of astronomical data in FITS format. Each row of the table consists of a fixed-length sequence of ASCII characters divided into fields that correspond to the columns in the table. Add an HDU of type TFitsTable with the TFitsTableSpec specification to the FITS container. Then get a reference to the TFitsTableData object, and use its properties and methods to iterate through the table’s records and fields to write values. See also the “newtable” demo.</p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">uses</span>
  <span class="p">...,</span> <span class="n">DeLaFitsCommon</span><span class="p">,</span> <span class="n">DeLaFitsClasses</span><span class="p">,</span> <span class="n">DeLaFitsTable</span><span class="p">;</span>
</code></pre></div></div><p><em>Create a new empty file and use it to create the FITS container</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LStream</span> <span class="p">:=</span> <span class="n">TFileStream</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">'new.fits'</span><span class="p">,</span> <span class="n">fmCreate</span><span class="p">);</span>
<span class="n">LContainer</span> <span class="p">:=</span> <span class="n">TFitsContainer</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">LStream</span><span class="p">);</span>
</code></pre></div></div><p><em>Create a new table specification with three fields: string, integer, and floating point</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LFieldInfo1</span> <span class="p">:=</span> <span class="n">CreateStringFieldInfo</span><span class="p">(</span>
  <span class="cm">{AFieldNumber:}</span> <span class="m">1</span><span class="p">,</span>
  <span class="cm">{AFieldWidth:}</span> <span class="m">10</span><span class="p">,</span>
  <span class="cm">{AFieldPosition:}</span> <span class="m">1</span><span class="p">,</span>
  <span class="cm">{AFieldName:}</span> <span class="s">'COLUMN1'</span><span class="p">);</span>
<span class="n">LFieldInfo2</span> <span class="p">:=</span> <span class="n">CreateIntegerFieldInfo</span><span class="p">(</span>
  <span class="cm">{AFieldNumber:}</span> <span class="m">2</span><span class="p">,</span>
  <span class="cm">{AFieldWidth:}</span> <span class="m">10</span><span class="p">,</span>
  <span class="cm">{AFieldPosition:}</span> <span class="m">12</span><span class="p">,</span>
  <span class="cm">{AFieldName:}</span> <span class="s">'COLUMN2'</span><span class="p">);</span>
<span class="n">LFieldInfo3</span> <span class="p">:=</span> <span class="n">CreateFixedFieldInfo</span><span class="p">(</span>
  <span class="cm">{AFieldNumber:}</span> <span class="m">3</span><span class="p">,</span>
  <span class="cm">{AFieldWidth:}</span> <span class="m">10</span><span class="p">,</span>
  <span class="cm">{AFieldPrecision:}</span> <span class="m">2</span><span class="p">,</span>
  <span class="cm">{AFieldPosition:}</span> <span class="m">23</span><span class="p">,</span>
  <span class="cm">{AFieldName:}</span> <span class="s">'COLUMN3'</span><span class="p">);</span>

<span class="n">LSpec</span> <span class="p">:=</span> <span class="n">TFitsTableSpec</span><span class="p">.</span><span class="n">CreateNewFields</span><span class="p">(</span>
  <span class="cm">{ARecordSize:}</span> <span class="m">43</span><span class="p">,</span>
  <span class="cm">{ARecordCount:}</span> <span class="m">5</span><span class="p">,</span>
  <span class="p">[</span><span class="n">LFieldInfo1</span><span class="p">,</span> <span class="n">LFieldInfo2</span><span class="p">,</span> <span class="n">LFieldInfo3</span><span class="p">]);</span>
</code></pre></div></div><p><em>Add a new HDU of type TFitsTable (TABLE extension) to the FITS container. Get a reference to the data object of the selected table</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LTable</span> <span class="p">:=</span> <span class="n">LContainer</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">TFitsTable</span><span class="p">,</span> <span class="n">LSpec</span><span class="p">)</span> <span class="k">as</span> <span class="n">TFitsTable</span><span class="p">;</span>
<span class="n">LData</span> <span class="p">:=</span> <span class="n">LTable</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
</code></pre></div></div><p><em>Get a reference to the table fields</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LField1</span> <span class="p">:=</span> <span class="n">LData</span><span class="p">.</span><span class="n">Fields</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="k">as</span> <span class="n">TFitsStringField</span><span class="p">;</span>
<span class="n">LField2</span> <span class="p">:=</span> <span class="n">LData</span><span class="p">.</span><span class="n">Fields</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="k">as</span> <span class="n">TFitsIntegerField</span><span class="p">;</span>
<span class="n">LField3</span> <span class="p">:=</span> <span class="n">LData</span><span class="p">.</span><span class="n">Fields</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="k">as</span> <span class="n">TFitsFloatField</span><span class="p">;</span>
</code></pre></div></div><p><em>Write the table records</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">LRecordIndex</span> <span class="p">:=</span> <span class="m">0</span> <span class="k">to</span> <span class="n">LData</span><span class="p">.</span><span class="n">RecordCount</span> <span class="p">-</span> <span class="m">1</span> <span class="k">do</span>
<span class="k">begin</span>
  <span class="n">LData</span><span class="p">.</span><span class="n">OpenRecord</span><span class="p">(</span><span class="n">LRecordIndex</span><span class="p">);</span>
  <span class="n">LField1</span><span class="p">.</span><span class="n">ValueAsString</span> <span class="p">:=</span> <span class="p">...;</span>
  <span class="n">LField2</span><span class="p">.</span><span class="n">ValueAsInteger</span> <span class="p">:=</span> <span class="p">...;</span>
  <span class="n">LField3</span><span class="p">.</span><span class="n">ValueAsDouble</span> <span class="p">:=</span> <span class="p">...;</span>
  <span class="n">LData</span><span class="p">.</span><span class="n">PostRecord</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</code></pre></div></div><p><em>Free objects</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LSpec</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
<span class="n">LContainer</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
<span class="n">LStream</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
</code></pre></div></div><p><a href="#">⮝</a></p><h3 id="example-7-read-and-write-the-table-records"> <a href="#example-7-read-and-write-the-table-records" class="anchor-heading" aria-labelledby="example-7-read-and-write-the-table-records"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example 7. Read and write the TABLE records</h3><p>The TABLE extension instance provides a means of storing catalogs and tables of astronomical data in FITS format. Each row of the table consists of a fixed-length sequence of ASCII characters divided into fields that correspond to the columns in the table. To work with table data, set the HDU class to TFitsTable, get a reference to its data object, and iterate over the table’s records and fields to read and write their values. See also the “tablerecords” demo.</p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">uses</span>
  <span class="p">...,</span> <span class="n">DeLaFitsCommon</span><span class="p">,</span> <span class="n">DeLaFitsClasses</span><span class="p">,</span> <span class="n">DeLaFitsTable</span><span class="p">;</span>
</code></pre></div></div><p><em>Create the FITS container: open and parse the FITS file</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LStream</span> <span class="p">:=</span> <span class="n">TFileStream</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">'demo-table.fits'</span><span class="p">,</span> <span class="n">fmOpenReadWrite</span><span class="p">);</span>
<span class="n">LContainer</span> <span class="p">:=</span> <span class="n">TFitsContainer</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">LStream</span><span class="p">);</span>
</code></pre></div></div><p><em>Set the HDU class to TFitsTable and get its data object</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LIndex</span> <span class="p">:=</span> <span class="m">1</span><span class="p">;</span>
<span class="k">if</span> <span class="n">LContainer</span><span class="p">.</span><span class="n">ItemExtensionTypeIs</span><span class="p">(</span><span class="n">LIndex</span><span class="p">,</span> <span class="n">TFitsTable</span><span class="p">)</span> <span class="k">then</span>
<span class="k">begin</span>
  <span class="n">LContainer</span><span class="p">.</span><span class="n">ItemClasses</span><span class="p">[</span><span class="n">LIndex</span><span class="p">]</span> <span class="p">:=</span> <span class="n">TFitsTable</span><span class="p">;</span>
  <span class="n">LTable</span> <span class="p">:=</span> <span class="n">LContainer</span><span class="p">.</span><span class="n">Items</span><span class="p">[</span><span class="n">LIndex</span><span class="p">]</span> <span class="k">as</span> <span class="n">TFitsTable</span><span class="p">;</span>
  <span class="n">LData</span> <span class="p">:=</span> <span class="n">LTable</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</code></pre></div></div><p><em>Get a reference to the table fields</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LField1</span> <span class="p">:=</span> <span class="n">LData</span><span class="p">.</span><span class="n">FindField</span><span class="p">(</span><span class="s">'COLUMN1'</span><span class="p">)</span> <span class="k">as</span> <span class="n">TFitsStringField</span><span class="p">;</span>
<span class="n">LField2</span> <span class="p">:=</span> <span class="n">LData</span><span class="p">.</span><span class="n">FindField</span><span class="p">(</span><span class="s">'COLUMN2'</span><span class="p">)</span> <span class="k">as</span> <span class="n">TFitsStringField</span><span class="p">;</span>
<span class="n">LField3</span> <span class="p">:=</span> <span class="n">LData</span><span class="p">.</span><span class="n">FindField</span><span class="p">(</span><span class="s">'COLUMN3'</span><span class="p">)</span> <span class="k">as</span> <span class="n">TFitsIntegerField</span><span class="p">;</span>
<span class="n">LField4</span> <span class="p">:=</span> <span class="n">LData</span><span class="p">.</span><span class="n">FindField</span><span class="p">(</span><span class="s">'COLUMN4'</span><span class="p">)</span> <span class="k">as</span> <span class="n">TFitsFloatField</span><span class="p">;</span>
<span class="n">LField5</span> <span class="p">:=</span> <span class="n">LData</span><span class="p">.</span><span class="n">FindField</span><span class="p">(</span><span class="s">'COLUMN5'</span><span class="p">)</span> <span class="k">as</span> <span class="n">TFitsFloatField</span><span class="p">;</span>
<span class="n">LField6</span> <span class="p">:=</span> <span class="n">LData</span><span class="p">.</span><span class="n">FindField</span><span class="p">(</span><span class="s">'COLUMN6'</span><span class="p">)</span> <span class="k">as</span> <span class="n">TFitsFloatField</span><span class="p">;</span>
</code></pre></div></div><p><em>Read the table records</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">LRecordIndex</span> <span class="p">:=</span> <span class="m">0</span> <span class="k">to</span> <span class="n">LData</span><span class="p">.</span><span class="n">RecordCount</span> <span class="p">-</span> <span class="m">1</span> <span class="k">do</span>
<span class="k">begin</span>
  <span class="n">LData</span><span class="p">.</span><span class="n">OpenRecord</span><span class="p">(</span><span class="n">LRecordIndex</span><span class="p">);</span>
  <span class="n">LValue1</span> <span class="p">:=</span> <span class="n">LField1</span><span class="p">.</span><span class="n">ValueAsString</span><span class="p">;</span>
  <span class="n">LValue2</span> <span class="p">:=</span> <span class="n">LField2</span><span class="p">.</span><span class="n">ValueAsString</span><span class="p">;</span>
  <span class="n">LValue3</span> <span class="p">:=</span> <span class="n">LField3</span><span class="p">.</span><span class="n">ValueAsInteger</span><span class="p">;</span>
  <span class="n">LValue4</span> <span class="p">:=</span> <span class="n">LField4</span><span class="p">.</span><span class="n">ValueAsDouble</span><span class="p">;</span>
  <span class="n">LValue5</span> <span class="p">:=</span> <span class="n">LField5</span><span class="p">.</span><span class="n">ValueAsDouble</span><span class="p">;</span>
  <span class="n">LValue6</span> <span class="p">:=</span> <span class="n">LField6</span><span class="p">.</span><span class="n">ValueAsDouble</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</code></pre></div></div><p><em>Write the table records</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">LRecordIndex</span> <span class="p">:=</span> <span class="m">0</span> <span class="k">to</span> <span class="n">LData</span><span class="p">.</span><span class="n">RecordCount</span> <span class="p">-</span> <span class="m">1</span> <span class="k">do</span>
<span class="k">begin</span>
  <span class="n">LData</span><span class="p">.</span><span class="n">OpenRecord</span><span class="p">(</span><span class="n">LRecordIndex</span><span class="p">);</span>
  <span class="n">LField1</span><span class="p">.</span><span class="n">ValueAsString</span> <span class="p">:=</span> <span class="p">...;</span>
  <span class="n">LField2</span><span class="p">.</span><span class="n">ValueAsString</span> <span class="p">:=</span> <span class="p">...;</span>
  <span class="n">LField3</span><span class="p">.</span><span class="n">ValueAsInteger</span> <span class="p">:=</span> <span class="p">...;</span>
  <span class="n">LField4</span><span class="p">.</span><span class="n">ValueAsDouble</span> <span class="p">:=</span> <span class="p">...;</span>
  <span class="n">LField5</span><span class="p">.</span><span class="n">ValueAsDouble</span> <span class="p">:=</span> <span class="p">...;</span>
  <span class="n">LField6</span><span class="p">.</span><span class="n">ValueAsDouble</span> <span class="p">:=</span> <span class="p">...;</span>
  <span class="n">LData</span><span class="p">.</span><span class="n">PostRecord</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</code></pre></div></div><p><em>Add a new table record</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LData</span><span class="p">.</span><span class="n">AddRecord</span><span class="p">;</span>
<span class="n">LField1</span><span class="p">.</span><span class="n">ValueAsString</span> <span class="p">:=</span> <span class="p">...;</span>
<span class="n">LField2</span><span class="p">.</span><span class="n">ValueAsString</span><span class="p">:=</span> <span class="p">...;</span>
<span class="n">LField3</span><span class="p">.</span><span class="n">ValueAsInteger</span> <span class="p">:=</span> <span class="p">...;</span>
<span class="n">LField4</span><span class="p">.</span><span class="n">ValueAsDouble</span> <span class="p">:=</span> <span class="p">...;</span>
<span class="n">LField5</span><span class="p">.</span><span class="n">ValueAsDouble</span> <span class="p">:=</span> <span class="p">...;</span>
<span class="n">LField6</span><span class="p">.</span><span class="n">ValueAsDouble</span> <span class="p">:=</span> <span class="p">...;</span>
<span class="n">LData</span><span class="p">.</span><span class="n">PostRecord</span><span class="p">;</span>
</code></pre></div></div><p><em>Display table records</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">LRecordIndex</span> <span class="p">:=</span> <span class="m">0</span> <span class="k">to</span> <span class="n">LData</span><span class="p">.</span><span class="n">RecordCount</span> <span class="p">-</span> <span class="m">1</span> <span class="k">do</span>
<span class="k">begin</span>
  <span class="n">LData</span><span class="p">.</span><span class="n">OpenRecord</span><span class="p">(</span><span class="n">LRecordIndex</span><span class="p">);</span>
  <span class="n">LDisplayRecord</span> <span class="p">:=</span> <span class="s">''</span><span class="p">;</span>
  <span class="k">for</span> <span class="n">LFieldNumber</span> <span class="p">:=</span> <span class="m">1</span> <span class="k">to</span> <span class="n">LData</span><span class="p">.</span><span class="n">FieldCount</span> <span class="k">do</span>
    <span class="n">LDisplayRecord</span> <span class="p">:=</span> <span class="n">LDisplayRecord</span> <span class="p">+</span> <span class="s">' '</span> <span class="p">+</span>
      <span class="n">LData</span><span class="p">.</span><span class="n">Fields</span><span class="p">[</span><span class="n">LFieldNumber</span><span class="p">].</span><span class="n">DisplayValue</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</code></pre></div></div><p><em>Free objects</em></p><div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LContainer</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
<span class="n">LStream</span><span class="p">.</span><span class="n">Free</span><span class="p">;</span>
</code></pre></div></div><p><a href="#">⮝</a></p><hr><footer><p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2013-2026, felleroff<br/>Support by <a href="mailto:delafits.library@gmail.com">delafits.library@gmail.com</a></p><div class="d-flex mt-2"></div></footer></div></div><div class="search-overlay"></div></div>
